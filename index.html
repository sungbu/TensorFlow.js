<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1.快速上手</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
    <!-- 图标库 -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"></script>
</head>
<body>
    <script>
        //画图表
        async function plot(pointArray,featureName) {
            tfvis.render.scatterplot(
                //图表名字
                {name: `${featureName} vs House Price`},
                //数据和数据类型名
                {values:[pointArray], series:["original"]},
                //x，y轴名称
                {
                    xLabel: featureName,
                    yLabel: "Price"
                }
            )
        }

        //讲数值归并到0-1区间
        //公式 x = x - min(x) / max(x) - min(x)
        function normalise(tensor) {
            const min = tensor.min();
            const max = tensor.max();

            const normalisedTensor = tensor.sub(min).div(max.sub(min));

            return {
                tensor: normalisedTensor,
                min,
                max
            };
        }

        //0-1之间的数据还原成真实数据
        function denormalise(tensor,min,max){
            const denormalisedTensor = tensor.mul(max.sub(min)).add(min);
            return denormalisedTensor;
        }


        async function run () {
            //加载csv数据集文件
            const houseScalesDataset = tf.data.csv("http://127.0.0.1:5500/kc_house_data.csv");
            //获取10条数据
            const sampleDataset = houseScalesDataset.take(10);
            //转成数组
            const dataArray = await sampleDataset.toArray();
            console.log(dataArray);

            //为图表做准备 x轴为sqft_living  y轴为price
            const points = houseScalesDataset.map(record => ({
                x: record.sqft_living,
                y: record.price
            }))

            // console.log(await points.toArray());

            plot(await points.toArray(),"Square Feet")


            //创建两个张量Tensor

            //提取一个特征  Feature（inputs）
            const featureValues = await points.map(p => p.x).toArray();
            const featureTensor = tf.tensor2d(featureValues,[featureValues.length, 1]);

            //提取一个标签   lable（outputs）
            const lableValues = await points.map(p => p.y).toArray();
            const lableTensor = tf.tensor2d(lableValues,[lableValues.length, 1]);

            //打印数据
            featureTensor.print();
            lableTensor.print();

            //数据归一化 0-1区间
            const normalisedFeature = normalise(featureTensor);
            const normalisedLable = normalise(lableTensor);

            //打印数据
            normalisedFeature.tensor.print();
            normalisedLable.tensor.print();

            //将0-1的数据转换成真实数据
            denormalise(normalisedFeature.tensor,normalisedFeature.min,normalisedFeature.max).print();
            denormalise(normalisedLable.tensor,normalisedLable.min,normalisedLable.max).print();
        }
        run();
    </script>
</body>
</html>